<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Proctored General Knowledge Quiz</title>
<style>
  body { font-family: 'Segoe UI', sans-serif; max-width: 720px; margin: 40px auto; background: #f5f7fa; padding: 30px 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); color:#333; }
  h1 { text-align:center; color:#2c3e50; margin-bottom: 35px; }
  .question-block { background:#fff; padding:20px; border-radius:8px; margin-bottom:20px; box-shadow:0 2px 8px rgba(0,0,0,0.07); }
  .options { list-style:none; padding:0; }
  label { display:flex; align-items:center; padding:10px; cursor:pointer; border-radius:6px; border:2px solid transparent; transition:all 0.3s; }
  input[type="radio"] { margin-right:10px; transform:scale(1.2); accent-color:#3498db; }
  label:hover { background:#f0f8ff; }
  .correct { color:#27ae60; font-weight:700; }
  .incorrect { color:#e74c3c; font-weight:700; }
  #submit-btn { background:#3498db; color:white; padding:15px 30px; border:none; border-radius:8px; font-weight:700; cursor:pointer; display:block; margin:30px auto; width:100%; max-width:320px; }
  #submit-btn:disabled { background:#95a5a6; cursor:not-allowed; }
  #score { text-align:center; font-size:1.5rem; margin-top:30px; padding:15px; border-radius:8px; background:#ecf0f1; }
  #camera-preview { display:block; margin: 20px auto; border-radius:8px; width:320px; height:240px; background:#000; }
  #warning { color:#e74c3c; text-align:center; font-weight:700; margin-top:15px; }
</style>
</head>
<body>

<h1>Proctored General Knowledge Quiz</h1>

<video id="camera-preview" autoplay muted></video>
<div id="warning"></div>

<div id="quiz-container"></div>
<button id="submit-btn">Submit</button>
<div id="score"></div>

<script>
// --- Quiz Data ---
const questionPool = [
  { question: "What is the capital of France?", options: ["Paris","Berlin","Rome","Madrid"], answer:"Paris" },
  { question: "Who wrote 'Hamlet'?", options:["Charles Dickens","William Shakespeare","Mark Twain","Leo Tolstoy"], answer:"William Shakespeare" },
  { question: "What planet is known as the Red Planet?", options:["Venus","Saturn","Mars","Jupiter"], answer:"Mars" },
  { question: "Which element has the chemical symbol 'O'?", options:["Gold","Oxygen","Silver","Iron"], answer:"Oxygen" }
];
const quizContainer = document.getElementById('quiz-container');
const submitBtn = document.getElementById('submit-btn');
const scoreDisplay = document.getElementById('score');
const warningDisplay = document.getElementById('warning');
const video = document.getElementById('camera-preview');

let selectedAnswers = {};
let currentQuestions = [];
let warningCount = 0;
const MAX_WARNINGS = 3;

// --- Shuffle Helper ---
function shuffle(array){ for(let i=array.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [array[i],array[j]]=[array[j],array[i]];} return array;}

// --- Load Quiz ---
function loadQuiz(){
  selectedAnswers={};
  scoreDisplay.innerHTML="";
  warningDisplay.innerHTML="";
  submitBtn.disabled=false;
  currentQuestions = shuffle([...questionPool]);
  quizContainer.innerHTML="";
  currentQuestions.forEach((q,index)=>{
    const qDiv = document.createElement('div'); qDiv.classList.add('question-block');
    const questionElem = document.createElement('div'); questionElem.textContent=`${index+1}. ${q.question}`;
    const optionsList = document.createElement('ul'); optionsList.classList.add('options');
    q.options.forEach(option=>{
      const li = document.createElement('li');
      const label = document.createElement('label');
      const input = document.createElement('input'); input.type='radio'; input.name='q'+index; input.value=option;
      input.addEventListener('change',(e)=>{selectedAnswers[index]=e.target.value;});
      label.appendChild(input); label.appendChild(document.createTextNode(' '+option));
      li.appendChild(label); optionsList.appendChild(li);
    });
    qDiv.appendChild(questionElem); qDiv.appendChild(optionsList);
    quizContainer.appendChild(qDiv);
  });
}

// --- Show Score ---
function showScore(){
  let score=0;
  for(let i=0;i<currentQuestions.length;i++){
    if(selectedAnswers[i]===currentQuestions[i].answer) score++;
  }
  scoreDisplay.innerHTML=`You scored ${score} out of ${currentQuestions.length}!`;
  submitBtn.disabled=true;
  // Highlight answers
  const blocks = document.querySelectorAll('.question-block');
  blocks.forEach((block,idx)=>{
    block.querySelectorAll('input[type=radio]').forEach(input=>{
      input.disabled=true;
      const label = input.parentElement;
      if(input.value===currentQuestions[idx].answer) label.classList.add('correct');
      if(input.checked && input.value!==currentQuestions[idx].answer) label.classList.add('incorrect');
    });
  });
}

// --- Submit Button ---
submitBtn.addEventListener('click',()=>{
  if(Object.keys(selectedAnswers).length < currentQuestions.length){
    alert('Please answer all questions before submitting.');
    return;
  }
  showScore();
});

// --- Tab Switching Detection ---
document.addEventListener('visibilitychange', ()=>{
  if(document.hidden){
    warningCount++;
    warningDisplay.textContent=`Warning! You left the quiz tab (${warningCount}/${MAX_WARNINGS})`;
    console.warn(`User left tab: warning ${warningCount}`);
    if(warningCount>=MAX_WARNINGS){
      alert('Maximum tab switches exceeded. Auto-submitting quiz.');
      showScore();
    }
  }
});

// --- Camera Proctoring ---
async function startCamera(){
  try{
    const stream = await navigator.mediaDevices.getUserMedia({video:true});
    video.srcObject=stream;
  }catch(err){
    alert('Camera permission is required to start the quiz.');
    submitBtn.disabled=true;
  }
}

// --- Initialize ---
startCamera().then(loadQuiz);

</script>
</body>
</html>
